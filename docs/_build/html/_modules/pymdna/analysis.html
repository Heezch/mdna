<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>pymdna.analysis &#8212; mdna 1.0.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../../_static/alabaster.css?v=12dfc556" />
    <script src="../../_static/documentation_options.js?v=8d563738"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
   
  <link rel="stylesheet" href="../../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for pymdna.analysis</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">joblib</span> <span class="kn">import</span> <span class="n">Parallel</span><span class="p">,</span> <span class="n">delayed</span>
    <span class="n">joblib_available</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">joblib_available</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;joblib is not installed. Falling back to sequential computation.&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">mdtraj</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">warnings</span>
<span class="kn">from</span> <span class="nn">.utils</span> <span class="kn">import</span> <span class="n">get_sequence_letters</span><span class="p">,</span> <span class="n">get_base_pair_letters</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">CubicSpline</span>
<span class="kn">import</span> <span class="nn">mdtraj</span> <span class="k">as</span> <span class="nn">md</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="k">as</span> <span class="nn">mpl</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="k">def</span> <span class="nf">_compute_distance</span><span class="p">(</span><span class="n">xyz</span><span class="p">,</span> <span class="n">pairs</span><span class="p">):</span>
    <span class="s2">&quot;Distance between pairs of points in each frame&quot;</span>
    <span class="n">delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">xyz</span><span class="p">[:,</span> <span class="n">pairs</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)[:,</span> <span class="p">:,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">delta</span> <span class="o">**</span> <span class="mf">2.</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">**</span> <span class="mf">0.5</span>

<div class="viewcode-block" id="GrooveAnalysis">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis">[docs]</a>
<span class="k">class</span> <span class="nc">GrooveAnalysis</span><span class="p">:</span>
<span class="w">    </span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    DNA groove analysis</span>

<span class="sd">    Example usage:</span>

<span class="sd">    traj = md.load(&#39;./data/md/0_highaff/FI/drytrajs/dry_10.xtc&#39;,top=&#39;./data/md/0_highaff/FI/drytrajs/dry_10.pdb&#39;)</span>
<span class="sd">    grooves = GrooveAnalysis(traj) </span>
<span class="sd">    fig,ax=plt.subplots(figsize=(4,2))</span>
<span class="sd">    grooves.plot_groove_widths(ax=ax)</span>

<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_traj</span><span class="p">,</span> <span class="n">points</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">parallel</span><span class="o">=</span><span class="n">joblib_available</span><span class="p">):</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">use_parallel</span> <span class="o">=</span> <span class="n">parallel</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="n">points</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sequence</span> <span class="o">=</span> <span class="n">get_sequence_letters</span><span class="p">(</span><span class="n">raw_traj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">base_pairs</span> <span class="o">=</span> <span class="n">get_base_pair_letters</span><span class="p">(</span><span class="n">raw_traj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">get_phosphors_only_traj</span><span class="p">(</span><span class="n">raw_traj</span><span class="p">)</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nbp</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">_residues</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
        
        <span class="c1"># Fit cubic spline curves based on phosphor atoms in strands</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">points</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nbp</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fit_cubic_spline</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">compute_groove_widths</span><span class="p">()</span>
    
<div class="viewcode-block" id="GrooveAnalysis.describe">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.describe">[docs]</a>
    <span class="k">def</span> <span class="nf">describe</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Your DNA has </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">nbp</span><span class="si">}</span><span class="s1"> base pairs and contains </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">n_frames</span><span class="si">}</span><span class="s1"> frames.&#39;</span><span class="p">)</span></div>

     
<div class="viewcode-block" id="GrooveAnalysis.get_phosphors_only_traj">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.get_phosphors_only_traj">[docs]</a>
    <span class="k">def</span> <span class="nf">get_phosphors_only_traj</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">raw_traj</span><span class="p">):</span>

        <span class="c1"># Assuming first two chains are the DNA strands</span>
        <span class="n">DNA_indices</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">raw_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">_chains</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">c</span><span class="o">.</span><span class="n">atoms</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span> <span class="o">=</span> <span class="n">raw_traj</span><span class="o">.</span><span class="n">atom_slice</span><span class="p">(</span><span class="n">DNA_indices</span><span class="p">)</span>

         <span class="c1"># Select only phosphor atoms</span>
        <span class="n">phos_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name P&#39;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phos_traj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">atom_slice</span><span class="p">(</span><span class="n">phos_indices</span><span class="p">)</span><span class="o">.</span><span class="n">center_coordinates</span><span class="p">()</span>
        
        <span class="c1"># Make new topology of chains</span>
        <span class="n">phos_chain_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phos_traj</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">phos_chain_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phos_traj</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="c1"># Split phos traj in two seperate traj for each strand</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strand_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phos_traj</span><span class="o">.</span><span class="n">atom_slice</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phos_chain_A</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">strand_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phos_traj</span><span class="o">.</span><span class="n">atom_slice</span><span class="p">([</span><span class="n">i</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">phos_chain_B</span><span class="o">.</span><span class="n">atoms</span><span class="p">])</span></div>

        
<div class="viewcode-block" id="GrooveAnalysis.fit_cubic_spline">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.fit_cubic_spline">[docs]</a>
    <span class="k">def</span> <span class="nf">fit_cubic_spline</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
        <span class="c1"># fit cubic spline curve</span>
        <span class="n">curves_A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_curves</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strand_A</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>
        <span class="n">curves_B</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fit_curves</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strand_B</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">points</span><span class="p">)</span>

        <span class="c1"># reshape back to trajectory xyz format</span>
        <span class="n">a_curve_xyz</span> <span class="o">=</span> <span class="n">curves_A</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">b_curve_xyz</span> <span class="o">=</span> <span class="n">curves_B</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>

        <span class="c1"># convert curves to xyz format</span>
        <span class="n">curves</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">a_curve_xyz</span><span class="p">,</span><span class="n">b_curve_xyz</span><span class="p">))</span>

        <span class="c1"># Retrieve &quot;predicted points/particles&quot;</span>
        <span class="n">n_points</span> <span class="o">=</span> <span class="n">curves</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">points_strand_A</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,(</span><span class="nb">int</span><span class="p">((</span><span class="n">n_points</span><span class="o">/</span><span class="mi">2</span><span class="p">))))</span>
        <span class="n">points_strand_B</span> <span class="o">=</span> <span class="nb">range</span><span class="p">((</span><span class="nb">int</span><span class="p">((</span><span class="n">n_points</span><span class="o">/</span><span class="mi">2</span><span class="p">))),(</span><span class="nb">int</span><span class="p">((</span><span class="n">n_points</span><span class="p">))))</span>

        <span class="c1"># Generate pairs between the two strands</span>
        <span class="c1">#self.pairs = list(itertools.product(points_strand_A, points_strand_B))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">=</span> <span class="p">[(</span><span class="n">point_A</span><span class="p">,</span> <span class="n">point_B</span><span class="p">)</span> <span class="k">for</span> <span class="n">point_A</span> <span class="ow">in</span> <span class="n">points_strand_A</span> <span class="k">for</span> <span class="n">point_B</span> <span class="ow">in</span> <span class="n">points_strand_B</span><span class="p">]</span>

        <span class="c1"># Calculate pair distances</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">_compute_distance</span><span class="p">(</span><span class="n">curves</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span>

        <span class="c1"># Reshape pair distances to n x n matrix and account for vdWaals radii of P atoms</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">shape</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distance_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="n">points_strand_A</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">points_strand_B</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">,:,::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.58</span></div>

    

<div class="viewcode-block" id="GrooveAnalysis.fit_curves">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.fit_curves">[docs]</a>
    <span class="k">def</span> <span class="nf">fit_curves</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">points</span><span class="p">):</span>
        
        <span class="c1"># make curve with shape[n_particles, xyz, time]</span>
        <span class="n">xyz</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">xyz</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">n_particles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">)</span>
        <span class="n">particle_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">n_particles</span><span class="p">))</span>

        <span class="c1"># initialize predictor based on # of actual particles</span>
        <span class="n">predictor</span> <span class="o">=</span> <span class="n">CubicSpline</span><span class="p">(</span><span class="n">particle_list</span><span class="p">,</span><span class="n">xyz</span><span class="p">)</span>

        <span class="c1"># points of curve to interpolate the particles </span>
        <span class="k">return</span> <span class="n">predictor</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">xyz</span><span class="p">),</span><span class="n">points</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="GrooveAnalysis.find_first_local_minimum">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.find_first_local_minimum">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">find_first_local_minimum</span><span class="p">(</span><span class="n">arr</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="ow">and</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]:</span>
                <span class="k">return</span> <span class="n">arr</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>  <span class="c1"># Return the first local minimum found</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">NaN</span>  <span class="c1"># Return None if no local minimum is found</span></div>


<div class="viewcode-block" id="GrooveAnalysis.split_array">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.split_array">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">split_array</span><span class="p">(</span><span class="n">array</span><span class="p">):</span>
        <span class="c1"># Compute the midpoint of the array</span>
        <span class="n">midpoint</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span>
        
        <span class="c1"># If the length of the array is odd, exclude the middle element. </span>
        <span class="c1"># If it&#39;s even, split the array into two equal halves.</span>
        <span class="c1"># Return the two halves that correspond to lower and upper triangles of the distance matrix</span>
        <span class="c1"># Reverse the first array because the order of the anti diagonal&#39;s in the opposite direction of backone/trailing diagonal</span>
        <span class="k">return</span> <span class="n">array</span><span class="p">[:</span><span class="n">midpoint</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">array</span><span class="p">[</span><span class="n">midpoint</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">array</span><span class="p">)</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:]</span></div>


<div class="viewcode-block" id="GrooveAnalysis.get_anti_diagonal_slices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.get_anti_diagonal_slices">[docs]</a>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get_anti_diagonal_slices</span><span class="p">(</span><span class="n">matrix</span><span class="p">):</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">matrix</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># Get the size of the matrix and skip the first and last anti diagonal</span>
        <span class="k">return</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">flipud</span><span class="p">(</span><span class="n">matrix</span><span class="p">),</span> <span class="n">offset</span><span class="p">)</span> <span class="k">for</span> <span class="n">offset</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">),</span> <span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)]</span></div>



<div class="viewcode-block" id="GrooveAnalysis.get_minor_major_widths">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.get_minor_major_widths">[docs]</a>
    <span class="k">def</span> <span class="nf">get_minor_major_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">distance_matrix</span><span class="p">):</span>

        <span class="c1"># Split the distance matrix into anti diagonal slices</span>
        <span class="n">diagonal_slices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_anti_diagonal_slices</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span>
        
        <span class="n">minor_widths</span><span class="p">,</span> <span class="n">major_widths</span> <span class="o">=</span> <span class="p">[],[]</span>
        <span class="k">for</span> <span class="n">slice_</span> <span class="ow">in</span> <span class="n">diagonal_slices</span><span class="p">:</span>
            <span class="n">minor</span><span class="p">,</span> <span class="n">major</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_array</span><span class="p">(</span><span class="n">slice_</span><span class="p">)</span>
            <span class="n">major_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_first_local_minimum</span><span class="p">(</span><span class="n">major</span><span class="p">))</span>  <span class="c1"># Find local minimum in the major slice and add it to the list</span>
            <span class="n">minor_widths</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">find_first_local_minimum</span><span class="p">(</span><span class="n">minor</span><span class="p">))</span>  <span class="c1"># Find local minimum in the minor slice and add it to the list </span>
        
        <span class="k">return</span> <span class="n">minor_widths</span><span class="p">,</span> <span class="n">major_widths</span></div>


<div class="viewcode-block" id="GrooveAnalysis.compute_groove_widths">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.compute_groove_widths">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_groove_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">use_parallel</span><span class="p">:</span>
            <span class="c1"># Parallelize the computation and subtract 0.58 to account for the vdw radius of the phosphorus atoms</span>
            <span class="n">results</span> <span class="o">=</span> <span class="n">Parallel</span><span class="p">(</span><span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)(</span><span class="n">delayed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_minor_major_widths</span><span class="p">)(</span><span class="n">distance_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">distance_matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_matrices</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># Compute sequentially</span>
            <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">get_minor_major_widths</span><span class="p">(</span><span class="n">distance_matrix</span><span class="p">)</span> <span class="k">for</span> <span class="n">distance_matrix</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">distance_matrices</span><span class="p">]</span>

        <span class="n">minor_widths_batch</span><span class="p">,</span> <span class="n">major_widths_batch</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">results</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">minor_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">minor_widths_batch</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">major_widths</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">major_widths_batch</span><span class="p">)</span></div>



<div class="viewcode-block" id="GrooveAnalysis.plot_width">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.plot_width">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_width</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">,</span><span class="n">groove</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
            
        <span class="c1"># Calculate the mean and standard deviation of major widths</span>
        <span class="c1"># Suppress warnings for mean of empty slice</span>
            <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
                <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>    
                <span class="c1"># Calculate the mean and standard deviation of major widths</span>
                <span class="n">mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">groove</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">(</span><span class="n">groove</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">std</span><span class="p">:</span>
                <span class="c1"># Fill the area around the mean for widths</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">mean</span><span class="p">)),</span> <span class="n">mean</span> <span class="o">-</span> <span class="n">stds</span><span class="p">,</span> <span class="n">mean</span> <span class="o">+</span> <span class="n">stds</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span></div>


<div class="viewcode-block" id="GrooveAnalysis.plot_groove_widths">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.plot_groove_widths">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_groove_widths</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">minor</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">major</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span> <span class="n">c_minor</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">c_major</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">base_labels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;-&#39;</span><span class="p">):</span>

        <span class="c1"># Create a figure and axes for plotting</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">no_ax</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">_</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">no_ax</span> <span class="o">=</span> <span class="kc">False</span>

        <span class="c1"># If c_minor or c_major are not provided, use the general color</span>
        <span class="k">if</span> <span class="n">c_minor</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c_minor</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">if</span> <span class="n">c_major</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">c_major</span> <span class="o">=</span> <span class="n">color</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">minor</span> <span class="ow">and</span> <span class="n">major</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">c_minor</span> <span class="o">==</span> <span class="n">c_major</span><span class="p">):</span>
            <span class="n">c_minor</span> <span class="o">=</span> <span class="s1">&#39;cornflowerblue&#39;</span>
            <span class="n">c_major</span> <span class="o">=</span> <span class="s1">&#39;coral&#39;</span>

        <span class="k">if</span> <span class="n">minor</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_width</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">minor_widths</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_minor</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">major</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_width</span><span class="p">(</span><span class="n">ax</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">major_widths</span><span class="p">,</span> <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c_major</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="n">ls</span><span class="p">,</span><span class="n">lw</span><span class="o">=</span><span class="n">lw</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">base_labels</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">major_widths</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_pairs</span><span class="p">))</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">))</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">base_pairs</span><span class="p">,</span><span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">no_ax</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">_</span><span class="p">,</span> <span class="n">ax</span></div>


    <span class="k">def</span> <span class="nf">calculate_groove_depths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Having defined a groove width by a minimal distance at some point along the nucleic acid fragment,</span>
        <span class="c1"># we have to calculate the corresponding groove depth. </span>

        <span class="c1"># At a base pair level, this is defined as the distance from the centre of </span>
        <span class="c1"># the backbone-to-backbone width vector to the mid-point of a vector defining the corresponding base pair. </span>
        <span class="c1"># This vector is constructed using the C8 atom of purines and the C6 atom of pyrimidines </span>

        <span class="c1"># For groove depths half-way between base pair levels,</span>
        <span class="c1"># we use the average of the corresponding base pair vector mid-points. </span>
        <span class="k">pass</span>

<div class="viewcode-block" id="GrooveAnalysis.calculate_groove_depths">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.GrooveAnalysis.calculate_groove_depths">[docs]</a>
    <span class="k">def</span> <span class="nf">calculate_groove_depths</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="c1"># Calculate the C8 and C6 atom positions of purines and pyrimidines</span>
        <span class="n">c8_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name C8&#39;</span><span class="p">)</span>
        <span class="n">c6_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;name C6&#39;</span><span class="p">)</span>
        <span class="n">c8_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span> <span class="n">c8_indices</span><span class="p">]</span>
        <span class="n">c6_positions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">DNA_traj</span><span class="o">.</span><span class="n">xyz</span><span class="p">[:,</span> <span class="n">c6_indices</span><span class="p">]</span>

        <span class="c1"># Calculate mid-points of vectors defining base pairs</span>
        <span class="n">base_pair_mid_points</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">c8_positions</span> <span class="o">+</span> <span class="n">c6_positions</span><span class="p">)</span>

        <span class="c1"># Calculate backbone-to-backbone width vector centres</span>
        <span class="n">backbone_width_vector_centres</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">strand_A</span><span class="o">.</span><span class="n">xyz</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">strand_B</span><span class="o">.</span><span class="n">xyz</span><span class="p">)</span>

        <span class="c1"># Calculate groove depths at base pair level</span>
        <span class="n">groove_depths_base_pair_level</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">base_pair_mid_points</span> <span class="o">-</span> <span class="n">backbone_width_vector_centres</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>

        <span class="c1"># For groove depths half-way between base pair levels, we use the average of the corresponding base pair vector mid-points</span>
        <span class="n">groove_depths_half_way</span> <span class="o">=</span> <span class="mf">0.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">groove_depths_base_pair_level</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">groove_depths_base_pair_level</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>

        <span class="k">return</span> <span class="n">groove_depths_base_pair_level</span><span class="p">,</span> <span class="n">groove_depths_half_way</span></div>
</div>



<div class="viewcode-block" id="TorsionAnalysis">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis">[docs]</a>
<span class="k">class</span> <span class="nc">TorsionAnalysis</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    torsions = mdna.TorsionAnalysis(traj)</span>
<span class="sd">    epsi, zeta = torsions.compute_BI_BII()</span>
<span class="sd">    B_state = torsions.B_state </span>
<span class="sd">    epsi.shape, zeta.shape, B_state.shape</span>
<span class="sd">    plt.plot(B_state)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">chain</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">=</span> <span class="n">chain</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dna</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_trajectory_and_slice_dna</span><span class="p">(</span><span class="n">traj</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_BI_BII</span><span class="p">(</span><span class="n">degrees</span><span class="o">=</span><span class="n">degrees</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">B_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_B_state</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">epsilon</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">zeta</span><span class="p">)</span>

<div class="viewcode-block" id="TorsionAnalysis.load_trajectory_and_slice_dna">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.load_trajectory_and_slice_dna">[docs]</a>
    <span class="k">def</span> <span class="nf">load_trajectory_and_slice_dna</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">traj</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot; Load trajectory&#39;s topology and slice DNA part &quot;&quot;&quot;</span>
        <span class="n">dna</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">atom_slice</span><span class="p">(</span><span class="n">traj</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s1">&#39;resname DG DC DA DT&#39;</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">dna</span></div>

        
<div class="viewcode-block" id="TorsionAnalysis.get_backbone_indices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.get_backbone_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">get_backbone_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainid</span><span class="p">,</span> <span class="n">ref_atoms</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="c1"># find torsions based on the epsilon and zeta atoms</span>
        <span class="c1"># finally map the torsions for all base steps </span>
        <span class="k">if</span> <span class="n">chainid</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dna</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">chainid</span><span class="p">]</span><span class="o">.</span><span class="n">residues</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">residues</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dna</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">_chains</span><span class="p">[</span><span class="n">chainid</span><span class="p">]</span><span class="o">.</span><span class="n">_residues</span>
            
        <span class="k">for</span> <span class="n">res</span> <span class="ow">in</span> <span class="n">residues</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">res</span><span class="o">.</span><span class="n">atoms</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="ow">in</span> <span class="n">ref_atoms</span><span class="p">:</span>
                    <span class="n">indices</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">at</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">indices</span></div>


<div class="viewcode-block" id="TorsionAnalysis.get_torsions">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.get_torsions">[docs]</a>
    <span class="k">def</span> <span class="nf">get_torsions</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">ref_atoms</span><span class="p">):</span>
        <span class="c1"># Find the chunks based on ref_atoms</span>
        <span class="n">torsions</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">while</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">):</span>
            <span class="n">ref</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_atoms</span><span class="p">)]]</span>
            <span class="k">if</span> <span class="n">ref</span> <span class="o">==</span> <span class="n">ref_atoms</span><span class="p">:</span>
                <span class="n">torsions</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">indices</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span><span class="o">+</span><span class="nb">len</span><span class="p">(</span><span class="n">ref_atoms</span><span class="p">)])</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">ref_atoms</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="k">return</span> <span class="n">torsions</span></div>


<div class="viewcode-block" id="TorsionAnalysis.get_torsion_indices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.get_torsion_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">get_torsion_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">chainid</span><span class="p">,</span> <span class="n">ref_atoms</span><span class="p">):</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_backbone_indices</span><span class="p">(</span><span class="n">chainid</span><span class="p">,</span> <span class="n">ref_atoms</span><span class="p">)</span>
        <span class="n">torsions</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_torsions</span><span class="p">(</span><span class="n">indices</span><span class="p">,</span> <span class="n">ref_atoms</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">torsions</span></div>


<div class="viewcode-block" id="TorsionAnalysis.convert_torsion_indices_to_atom_indices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.convert_torsion_indices_to_atom_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">convert_torsion_indices_to_atom_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">torsion_indices</span><span class="p">):</span>
        <span class="n">atom_indices</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">torsion</span> <span class="ow">in</span> <span class="n">torsion_indices</span><span class="p">:</span>
            <span class="n">atom_indices</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">at</span><span class="o">.</span><span class="n">index</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="n">torsion</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">atom_indices</span></div>


<div class="viewcode-block" id="TorsionAnalysis.compute_BI_BII">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.compute_BI_BII">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_BI_BII</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">degrees</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>

        <span class="n">epsilon_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C4&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;C3&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;O3&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;P&quot;</span><span class="p">]</span> 
        <span class="n">zeta_atoms</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;C3&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;O3&#39;&quot;</span><span class="p">,</span><span class="s2">&quot;P&quot;</span><span class="p">,</span><span class="s2">&quot;O5&#39;&quot;</span><span class="p">]</span>

        <span class="n">epsi_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_torsion_indices</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">epsilon_atoms</span><span class="p">)</span>
        <span class="n">epsi_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_torsion_indices</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">epsilon_atoms</span><span class="p">)</span>
        <span class="n">zeta_0</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_torsion_indices</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">zeta_atoms</span><span class="p">)</span>
        <span class="n">zeta_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_torsion_indices</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">zeta_atoms</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">epsi_0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">epsi_1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeta_0</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">zeta_1</span><span class="p">))</span>

        <span class="c1"># From here only the antisense strand is used</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">chain</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">e_torsion_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_torsion_indices_to_atom_indices</span><span class="p">(</span><span class="n">epsi_1</span><span class="p">)</span>
            <span class="n">z_torsion_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_torsion_indices_to_atom_indices</span><span class="p">(</span><span class="n">zeta_1</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">e_torsion_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_torsion_indices_to_atom_indices</span><span class="p">(</span><span class="n">epsi_0</span><span class="p">)</span>
            <span class="n">z_torsion_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">convert_torsion_indices_to_atom_indices</span><span class="p">(</span><span class="n">zeta_0</span><span class="p">)</span>

        <span class="n">epsi</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">compute_dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dna</span><span class="p">,</span> <span class="n">e_torsion_indices</span><span class="p">)</span>
        <span class="n">zeta</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">compute_dihedrals</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dna</span><span class="p">,</span> <span class="n">z_torsion_indices</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">degrees</span><span class="p">:</span>
            <span class="n">epsi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">epsi</span><span class="p">)</span>
            <span class="n">zeta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">degrees</span><span class="p">(</span><span class="n">zeta</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="n">epsi</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">zeta</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">epsi</span><span class="p">,</span> <span class="n">zeta</span></div>

    
<div class="viewcode-block" id="TorsionAnalysis.get_B_state">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.get_B_state">[docs]</a>
    <span class="k">def</span> <span class="nf">get_B_state</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">diff</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        BI = 0, BII = 1</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
        <span class="n">state</span><span class="p">[</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># BI</span>
        <span class="n">state</span><span class="p">[</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># BII</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="TorsionAnalysis.place_holder">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.TorsionAnalysis.place_holder">[docs]</a>
    <span class="k">def</span> <span class="nf">place_holder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">get_B_state</span><span class="p">(</span><span class="n">diff</span><span class="p">):</span>
            <span class="n">state</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">diff</span><span class="p">)</span>
            <span class="n">state</span><span class="p">[</span><span class="n">diff</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># BI</span>
            <span class="n">state</span><span class="p">[</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># BII</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">state</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">/</span><span class="n">state</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span>

        <span class="kn">from</span> <span class="nn">matplotlib.lines</span> <span class="kn">import</span> <span class="n">Line2D</span>

        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">nrows</span><span class="o">=</span><span class="n">epsi_t_haff</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">12</span><span class="p">),</span><span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">sharey</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,(</span><span class="n">e</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">epsi_t_haff</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">zeta_t_haff</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-</span><span class="n">z</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">get_B_state</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,(</span><span class="n">e</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">epsi_d_haff</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">zeta_d_haff</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-</span><span class="n">z</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">get_B_state</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,(</span><span class="n">e</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">epsi_t_gca</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">zeta_t_gca</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-</span><span class="n">z</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">get_B_state</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

        <span class="k">for</span> <span class="n">_</span><span class="p">,(</span><span class="n">e</span><span class="p">,</span><span class="n">z</span><span class="p">)</span><span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">epsi_d_gca</span><span class="o">.</span><span class="n">T</span><span class="p">,</span><span class="n">zeta_d_gca</span><span class="o">.</span><span class="n">T</span><span class="p">)):</span>
            <span class="n">d</span> <span class="o">=</span> <span class="n">e</span><span class="o">-</span><span class="n">z</span>
            <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span><span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;coral&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="n">get_B_state</span><span class="p">(</span><span class="n">d</span><span class="p">))</span>

            <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span><span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">epsi_t_haff</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Step </span><span class="si">{</span><span class="n">_</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([</span><span class="o">-</span><span class="mi">90</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">90</span><span class="p">])</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">_</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="mi">181</span><span class="p">,</span><span class="mi">181</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;High Affinity&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;GC-analogue&#39;</span><span class="p">)</span>

        <span class="c1"># Define custom legend</span>
        <span class="n">legend_elements</span> <span class="o">=</span> <span class="p">[</span><span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;cornflowerblue&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DNA-haff&#39;</span><span class="p">),</span>
                        <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;coral&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;DNA-gca&#39;</span><span class="p">),</span>
                        <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;navy&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FI-haff&#39;</span><span class="p">),</span>
                        <span class="n">Line2D</span><span class="p">([</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkred&#39;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;FI-gca&#39;</span><span class="p">)]</span>


        <span class="c1"># Add the custom legend to the figure (NOT the subplot)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">handles</span><span class="o">=</span><span class="n">legend_elements</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.15</span><span class="p">,</span> <span class="mf">0.89</span><span class="p">),</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;BII fraction&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Denstities of Anti Strand&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;Anti_BII_densities.png&#39;</span><span class="p">,</span><span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span><span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="ContactCount">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount">[docs]</a>
<span class="k">class</span> <span class="nc">ContactCount</span><span class="p">:</span>

<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>

<span class="sd">    Example Usage:</span>

<span class="sd">    protein_donors = {&#39;GLN112&#39;:[&#39;N&#39;,&#39;NE2&#39;],</span>
<span class="sd">                  &#39;GLY113&#39;:[&#39;N&#39;],</span>
<span class="sd">                  &#39;ARG114&#39;:[&#39;N&#39;,&#39;NE&#39;,&#39;NH1&#39;,&#39;NH2&#39;]}</span>

<span class="sd">    minor_acceptors = {&#39;DA&#39;:[&#39;N3&#39;],</span>
<span class="sd">                    &#39;DT&#39;:[&#39;O2&#39;],</span>
<span class="sd">                    &#39;DC&#39;:[&#39;O2&#39;],</span>
<span class="sd">                    &#39;DG&#39;:[&#39;N3&#39;]}</span>
<span class="sd">    </span>
<span class="sd">    major_acceptors = {&#39;DA&#39;:[&#39;N7&#39;],</span>
<span class="sd">                   &#39;DT&#39;:[&#39;&quot;O4&#39;&quot;&#39;],</span>
<span class="sd">                   &#39;DC&#39;:[&#39;None&#39;],</span>
<span class="sd">                   &#39;DG&#39;:[&#39;&quot;O4&#39;&quot;&#39;,&#39;N7&#39;]}</span>
<span class="sd">    </span>
<span class="sd">    # Here you can adjust the parameters nn and mm to change the shape of the smoothing function</span>
<span class="sd">    contacts = ContactCount(traj,protein_donors,minor_acceptors,d0=0.25,r0=0.4,nn=2,mm=4)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">traj</span><span class="p">,</span> <span class="n">protein_queue</span><span class="p">,</span> <span class="n">dna_haystack</span><span class="p">,</span> <span class="n">d0</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span><span class="n">r0</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">nn</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">mm</span><span class="o">=</span><span class="mi">4</span><span class="p">):</span>
        <span class="c1"># store trajectory and topology information</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">traj</span> <span class="o">=</span> <span class="n">traj</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">top</span> <span class="o">=</span> <span class="n">traj</span><span class="o">.</span><span class="n">topology</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">atom_names</span> <span class="o">=</span> <span class="p">[</span><span class="n">at</span> <span class="k">for</span> <span class="n">at</span> <span class="ow">in</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">atoms</span><span class="p">)]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protein_queue</span> <span class="o">=</span> <span class="n">protein_queue</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">dna_haystack</span> <span class="o">=</span> <span class="n">dna_haystack</span>
        
        <span class="c1"># store parameters</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="o">=</span><span class="n">d0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="o">=</span><span class="n">r0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">nn</span><span class="o">=</span><span class="n">nn</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="o">=</span><span class="n">mm</span>        

        <span class="c1"># get indices of protein and dna atoms</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">protein_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_protein_indices</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">groove_indices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_groove_indices</span><span class="p">()</span>
        
        <span class="c1"># compute distances and contacts</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">k</span><span class="p">,</span><span class="n">l</span><span class="p">]</span><span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_indices</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">groove_indices</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">distances</span> <span class="o">=</span> <span class="n">md</span><span class="o">.</span><span class="n">geometry</span><span class="o">.</span><span class="n">compute_distances</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">traj</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">pairs</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">compute_contacts</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contact_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contact_matrix</span><span class="p">()</span>

        <span class="c1"># collect sections of protein  (for plotting)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collect_sections</span><span class="p">()</span>
    
<div class="viewcode-block" id="ContactCount.get_protein_indices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_protein_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">get_protein_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find protein indices corresponding to queue (Restype-Atomtype) </span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_names</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">res</span><span class="o">+</span><span class="s1">&#39;-&#39;</span><span class="o">+</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">res</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_queue</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">at</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="ContactCount.get_groove_indices">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_groove_indices">[docs]</a>
    <span class="k">def</span> <span class="nf">get_groove_indices</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Find selection of atom types for each nucleobase</span>
        <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">sum</span><span class="p">([</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">top</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;resname </span><span class="si">{</span><span class="n">res</span><span class="si">}</span><span class="s2"> and </span><span class="si">{</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s1">&#39;name &#39;</span><span class="o">+</span><span class="n">i</span><span class="w"> </span><span class="k">for</span><span class="w"> </span><span class="n">i</span><span class="w"> </span><span class="ow">in</span><span class="w"> </span><span class="n">at</span><span class="p">])</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">))</span> <span class="k">for</span> <span class="n">res</span><span class="p">,</span><span class="n">at</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dna_haystack</span><span class="o">.</span><span class="n">items</span><span class="p">()],[]))</span></div>

    
<div class="viewcode-block" id="ContactCount.smooth_contact">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.smooth_contact">[docs]</a>
    <span class="k">def</span> <span class="nf">smooth_contact</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
        <span class="c1"># Compute contact based on distance smoothing function</span>
        <span class="k">return</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="p">((</span><span class="n">r</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">nn</span> <span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span> <span class="p">(</span><span class="n">r</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span><span class="p">)</span><span class="o">/</span><span class="bp">self</span><span class="o">.</span><span class="n">r0</span><span class="p">)</span><span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">mm</span><span class="p">)</span> <span class="p">)</span></div>


<div class="viewcode-block" id="ContactCount.compute_contacts">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.compute_contacts">[docs]</a>
    <span class="k">def</span> <span class="nf">compute_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Check where first condition holds</span>
        <span class="n">ones</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="c1"># Apply second condition</span>
        <span class="n">contacts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">d0</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">smooth_contact</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">),</span><span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="p">)</span>
        <span class="c1"># Apply second condition (...)</span>
        <span class="n">contacts</span><span class="p">[</span><span class="n">ones</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">ones</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contacts</span></div>


<div class="viewcode-block" id="ContactCount.get_total_contacts">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_total_contacts">[docs]</a>
    <span class="k">def</span> <span class="nf">get_total_contacts</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

    
<div class="viewcode-block" id="ContactCount.get_protein_names">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_protein_names">[docs]</a>
    <span class="k">def</span> <span class="nf">get_protein_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_indices</span><span class="p">]</span></div>

    
<div class="viewcode-block" id="ContactCount.get_dna_names">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_dna_names">[docs]</a>
    <span class="k">def</span> <span class="nf">get_dna_names</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">atom_names</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groove_indices</span><span class="p">)]</span></div>

    
<div class="viewcode-block" id="ContactCount.get_distance_matrix">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_distance_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">get_distance_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Reshape pair distances to n x n matrix</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">distances</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_indices</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groove_indices</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="ContactCount.get_contact_matrix">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contact_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contact_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># Reshape pair distances to n x n matrix</span>
        <span class="n">s</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">shape</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_indices</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">groove_indices</span><span class="p">))</span></div>

    
<div class="viewcode-block" id="ContactCount.collect_sections">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.collect_sections">[docs]</a>
    <span class="k">def</span> <span class="nf">collect_sections</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">section_ends</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">residue</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">protein_queue</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
            <span class="n">count</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">protein_queue</span><span class="p">[</span><span class="n">residue</span><span class="p">])</span>
            <span class="n">section_ends</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">sections</span> <span class="o">=</span> <span class="n">section_ends</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span></div>


<div class="viewcode-block" id="ContactCount.split_data">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.split_data">[docs]</a>
    <span class="k">def</span> <span class="nf">split_data</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contact_matrix</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">sections</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ContactCount.get_contacts_per_residue">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contacts_per_residue">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contacts_per_residue</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_data</span><span class="p">()])</span></div>

    
<div class="viewcode-block" id="ContactCount.get_contacts_per_residue_per_base">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contacts_per_residue_per_base">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contacts_per_residue_per_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">d</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">split_data</span><span class="p">()])</span></div>

            
<div class="viewcode-block" id="ContactCount.get_contacts_per_base">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contacts_per_base">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contacts_per_base</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>    
        <span class="n">contacts_per_residue_per_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contacts_per_residue_per_base</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">contacts_per_residue_per_base</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>     </div>

                         
<div class="viewcode-block" id="ContactCount.get_contacts_per_bp">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contacts_per_bp">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contacts_per_bp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">contacts_per_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contacts_per_base</span><span class="p">()</span>
        <span class="n">n_bases</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contacts_per_base</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">contacts_per_base</span><span class="p">[:</span><span class="n">n_bases</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span><span class="n">contacts_per_base</span><span class="p">[</span><span class="n">n_bases</span><span class="o">//</span><span class="mi">2</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span></div>

    
<div class="viewcode-block" id="ContactCount.get_contacts_per_residue_per_bp">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.get_contacts_per_residue_per_bp">[docs]</a>
    <span class="k">def</span> <span class="nf">get_contacts_per_residue_per_bp</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">contacts_per_residue_per_base</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contacts_per_residue_per_base</span><span class="p">()</span>
        <span class="n">n_bases</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">contacts_per_residue_per_base</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">a</span><span class="o">+</span><span class="n">b</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span><span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">contacts_per_residue_per_base</span><span class="o">.</span><span class="n">T</span><span class="p">[:</span><span class="n">n_bases</span><span class="o">//</span><span class="mi">2</span><span class="p">],</span> <span class="n">contacts_per_residue_per_base</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">n_bases</span><span class="o">//</span><span class="mi">2</span><span class="p">:][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])])</span><span class="o">.</span><span class="n">T</span></div>


<div class="viewcode-block" id="ContactCount.check_axis">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.check_axis">[docs]</a>
    <span class="k">def</span> <span class="nf">check_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span><span class="n">ax</span></div>

    
<div class="viewcode-block" id="ContactCount.plot_contact_map">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.plot_contact_map">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_contact_map</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">frame</span><span class="o">=-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">contact_matrices</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_contact_matrix</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">frame</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">contact_matrices</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span><span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">),</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">),</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">im</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">contact_matrices</span><span class="p">[</span><span class="n">frame</span><span class="p">],</span><span class="n">vmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">),</span> <span class="n">vmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">contacts</span><span class="p">),</span><span class="n">aspect</span><span class="o">=</span><span class="s1">&#39;auto&#39;</span><span class="p">)</span>


        <span class="n">protein_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_protein_names</span><span class="p">()</span>
        <span class="n">dna_labels</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_dna_names</span><span class="p">()</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">protein_labels</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">(</span><span class="n">protein_labels</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">dna_labels</span><span class="p">)))</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">dna_labels</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">80</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Contact map of frame </span><span class="si">{</span><span class="n">frame</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">im</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;$C_</span><span class="si">{Protein}</span><span class="s2">$&quot;</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ContactCount.plot_contact_distribution">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.plot_contact_distribution">[docs]</a>
    <span class="k">def</span> <span class="nf">plot_contact_distribution</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="s1">&#39;Red&#39;</span><span class="p">):</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_axis</span><span class="p">(</span><span class="n">ax</span><span class="p">)</span>
        <span class="n">total_contacts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_total_contacts</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">total_contacts</span><span class="p">)</span>

        <span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span>
                <span class="s2">&quot;idx&quot;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)),</span>
                <span class="s2">&quot;$C_{Protein-DNA}$&quot;</span><span class="p">:</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">ravel</span><span class="p">()})</span>

        <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
           <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;$C_{Protein-DNA}$&quot;</span><span class="p">,</span> <span class="n">legend</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span><span class="c1">#hue=&quot;idx&quot;,</span>
           <span class="n">fill</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">common_norm</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="s2">&quot;Reds&quot;</span><span class="p">,</span>
           <span class="n">alpha</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span></div>

        
<div class="viewcode-block" id="ContactCount.ns_to_steps">
<a class="viewcode-back" href="../../pymdna.html#pymdna.analysis.ContactCount.ns_to_steps">[docs]</a>
    <span class="k">def</span> <span class="nf">ns_to_steps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ns</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># assume a timestep of 2 fs</span>
        <span class="k">return</span> <span class="nb">int</span><span class="p">((</span><span class="n">ns</span><span class="o">*</span><span class="mi">1000</span><span class="p">)</span><span class="o">/</span><span class="mf">0.002</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../index.html">mdna</a></h1>








<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../modules.html">pymdna</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../../index.html">Documentation overview</a><ul>
  <li><a href="../index.html">Module code</a><ul>
  <li><a href="../pymdna.html">pymdna</a><ul>
  </ul></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<search id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2024, Thor van Heesch.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 7.3.7</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 0.7.16</a>
      
    </div>

    

    
  </body>
</html>